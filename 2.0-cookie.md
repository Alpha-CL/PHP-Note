# HTTP 会话

#### Cookie

> HTTP 很重要的一个特点 `无状态`( 每次见面都是 `初次见面`)
> 如果希望服务端程序去记住每个访问的访客是不可能的
> 必须借助一些手段或者技巧让服务端记住客户端，这种手段就是`Cookie`


``` vim


+ -------- +                                           + -------- + 
|          |                                           |          |
|          |                                           |          |
|          | ----------------------------------------> |          |
|          |                                           |          |
|          | GET http://www.example.com/ HTTP/1.1      |          |
|          |                                           |          |
|          |                                           |          |
|          | <---------------------------------------- |          |
|          |                                           |          |
|  Client  | HTTP/1.1 200 OK                           |  Server  |
|          | set-cookie: session-id=12345;             |          |
|          |                                           |          |
|          |                                           |          |
|          | ----------------------------------------> |          |
|          |                                           |          |
|          | GET http://www.example.com/ HTTP/1.1      |          |
|          | cookie: session-id=12345;                 |          |
|          |                                           |          |
|          |                                           |          |
+ -------- +                                           + -------- + 


```


#### 设置 Cookie


__php cookie__

``` php


//! set Response Headers 'Set-Cookie' => request server
header('Set-Cookie: foo = bar');


//! php set cookie method
//para1: 设置为一个过去时间
setcookie('key');

//para2: 设置 cookie 的 name value
setcookie('key1', 'value1');

//para3: 过期时间，过期后 cookie 不生效
setcookie('key2', 'value', time() + 1 * 24 + 60 * 60);

//para4: 设置 cookie domain ( 作用域名范围 )
setcookie('key4', 'value4', time() + 1 * 24 + 60 * 60, '/');


//TODO: para5, para6 ...
setcookie('key4', 'value4', time() + 1 * 24 + 60 * 60, '/', '', false, true);



//! receive cookie
var_dump($_COOKIE);


```

> JS cookie 无法访问到 。。。。。？


__JS cookie__

``` javascript


//set only cookie
document.cookie = 'js = fuck';

//receive all cookie
document.cookie;


```


#### Session


本地造假 cookie

``` javascript


var dt = new Date();

dt.setYear(2018);

document.cookie = 'app-installed=1; expires=' + dt.toGMTSring();


```

> Cookie 是服务器给客户由 `客户端本地保存`，客户可以在本地随意操作( 删除/修改 )
> 也可以伪造假 Cookie，对于服务端是无法辨别的，会造成 服务端被蒙蔽，构成`安全隐患`
> Session 是 Cookie 升级版


``` vim


                        + ------------------------------------------------------------------------------------- + 
                        |                                                                                       |
                        |                                                                                       |
                        |       Server                                                                          |
                        |                                                                                       |
                        |                        + ------------------------------------------------ +           |
                        |                        |                                                  |           |
+ ---------- +          |                        |                       Session                    |           |
|            |                                   |                                                  |           |
|            |      Cookie session_id=0x001      + ---------------- + ------------- + ------------- +           |      
|  client1   |---------------------------------> |  0x001           |  0x002        |  0x003        |           |
|            |          |                        + ---------------- + ------------- + ------------- +           | 
|            |          |                        | key1: hello      |  key1: some   |  key1:may     |           |
+ ---------- +          |                        + ---------------- + ------------- + ------------- +           |
+ ---------- +          |                        | key2: world      |  key2: time   |               |           |
|            |                                   + ---------------- + ------------- + ------------- +           |
|            |      Cookie session_id=0x002      |                  |  key3: ok     |               |           |
|  client2   |---------------------------------> + ---------------- + ------------- + ------------- +           |
|            |          |                        |                                                  |           |
|            |          |                        + ---------------- + ------------- + ------------- +           |
+ ---------- +          |                        |  0x004           |   0x005       |  0x006        |           |
+ ---------- +          |                        + ---------------- + ------------- + ------------- +           |
|            |                                   |  who             |               |               |           |                               
|            |      Cookie session_id=0x003      + ---------------- + ------------- + ------------- +           |         
|  client3   |---------------------------------> |                  |               |               |           |
|            |          |                        + ---------------- + ------------- + ------------- +           |
|            |          |                        |                  |               |               |           |
+ ---------- +          |                        + ---------------- + ------------- + ------------- +           |
                        |                        |                  |               |               |           |
                        |                        +------------------------------------------------- +           |
                        |                                                                                       |
                        |                                                                                       |
                        |                                                                                       |
                        + ------------------------------------------------------------------------------------- +
                                
           
```



__Session 与 Cookie 区别__

> Cookie 数据存放在`本地客户端`，Session 数据存放在`服务器`
> 用户无法修改客户端数据，所以相对安全



``` php


//帮助用户找箱子( 有则进入，无则创建 )
session_start();


//设置 session
$_SESSION['key'] = 'value';


```






































































